const modal=document.getElementById("contact-modal"),contactLink=document.getElementById("contact-link"),closeBtn=document.querySelector(".close");contactLink.addEventListener("click",async e=>{e.preventDefault(),modal.style.display="block";try{const e=await fetch("https://werdos.vercel.app/api/sendEmail",{method:"GET"});if(e.ok){const t=await e.json();document.getElementById("csrf-token").value=t.csrfToken}else throw new Error("Failed to fetch CSRF token")}catch(e){console.error("CSRF Token Error:",e)}}),closeBtn.addEventListener("click",()=>{modal.style.display="none"}),window.addEventListener("click",e=>{e.target===modal&&(modal.style.display="none")});const sanitizeInput=e=>e.replace(/</g,"&lt;").replace(/>/g,"&gt;");document.getElementById("contact-form").addEventListener("submit",async e=>{e.preventDefault();const t=sanitizeInput(document.getElementById("email").value),s=sanitizeInput(document.getElementById("subject").value),r=sanitizeInput(document.getElementById("message").value),o=document.getElementById("csrf-token").value;try{const e=await fetch("https://werdos.vercel.app/api/sendEmail",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":o},body:JSON.stringify({email:t,subject:s,message:r})});if(e.ok){alert("Message sent successfully!"),modal.style.display="none"}else throw new Error("Failed to send message")}catch(e){alert("Failed to send message. Please try again."),console.error("Error:",e)}});