const modal=document.getElementById("contact-modal"),contactLink=document.getElementById("contact-link"),closeBtn=document.querySelector(".close");contactLink.addEventListener("click",async e=>{e.preventDefault(),modal.style.display="block";try{let t=await fetch("https://werdos.vercel.app/api/sendEmail",{method:"GET",headers:{Authorization:`Bearer ${process.env.API_SECRET}`}});if(t.ok){let a=await t.json();document.getElementById("csrf-token").value=a.csrfToken}else throw Error("Failed to fetch CSRF token")}catch(n){console.error("CSRF Token Error:",n)}}),closeBtn.addEventListener("click",()=>{modal.style.display="none"}),window.addEventListener("click",e=>{e.target===modal&&(modal.style.display="none")});const sanitizeInput=e=>e.replace(/</g,"&lt;").replace(/>/g,"&gt;");document.getElementById("contact-form").addEventListener("submit",async e=>{e.preventDefault();let t=sanitizeInput(document.getElementById("email").value),a=sanitizeInput(document.getElementById("subject").value),n=sanitizeInput(document.getElementById("message").value),l=document.getElementById("csrf-token").value;try{let s=await fetch("https://werdos.vercel.app/api/sendEmail",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({email:t,subject:a,message:n})});if(s.ok)alert("Message sent successfully!"),modal.style.display="none";else throw Error("Failed to send message")}catch(o){alert("Failed to send message. Please try again."),console.error("Error:",o)}});