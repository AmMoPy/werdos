import{initializeClient,getCache,clearPendingRequests}from"./infapi.min.js";import{PrivacyManager,ResultsDisplay,ExampleImages,getURLManager}from"./ui.min.js";import{FileUploadHandler}from"./fup.min.js";import{InfiniteScrollHandler,BasicDragScroll}from"./scrll.min.js";import{MatrixAnim}from"./anim.min.js";import{CONFIG}from"./config.min.js";class InitApp{constructor(){this.scrollHandlers={examples:null,results:null};this.components={};this.animation=null}async initialize(){try{await initializeClient();this.initializeComponents();this.initializeScrollHandlers();this.initializeMtrxAnim();this.setupCleanupHandlers()}catch(error){console.error("WERDOS: Failed to initialize:",error);this.showErrorMessage("WERDOS Failed to initialize. Please refresh the page.")}}initializeComponents(){this.components.privacyManager=new PrivacyManager;this.components.resultsDisplay=new ResultsDisplay;this.components.exampleImages=new ExampleImages(this.components.resultsDisplay);this.components.fileUploadHandler=new FileUploadHandler(this.components.resultsDisplay)}initializeScrollHandlers(){const initScrollHandlers=()=>{this.scrollHandlers.examples=new InfiniteScrollHandler("examples-container",{speed:CONFIG.SCROLL.INFINITE_SPEED,pauseOnHover:CONFIG.SCROLL.PAUSE_ON_HOVER,dragMultiplier:CONFIG.SCROLL.DRAG_MULTIPLIER});this.scrollHandlers.results=new BasicDragScroll("results",{dragMultiplier:CONFIG.SCROLL.RESULTS_DRAG_MULTIPLIER})};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",initScrollHandlers)}else{initScrollHandlers()}}initializeMtrxAnim(){const initAnimation=()=>{const prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(!prefersReducedMotion&&document.visibilityState==="visible"){this.animation=new MatrixAnim}};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",initAnimation)}else{initAnimation()}}setupCleanupHandlers(){const cleanup=()=>{const urlManager=getURLManager();urlManager.cleanup();const cache=getCache();cache.clear();clearPendingRequests();if(this.animation){this.animation.destroy();this.animation=null}Object.values(this.scrollHandlers).forEach((handler=>{if(handler&&typeof handler.cleanup==="function"){handler.cleanup()}}));console.log("WERDOS: Cleanup completed")};window.addEventListener("beforeunload",cleanup);document.addEventListener("visibilitychange",(()=>{if(document.visibilityState==="hidden"){if(this.animation&&this.animation.animationId){this.animation.pause()}}else if(document.visibilityState==="visible"){if(this.animation&&!this.animation.animationId){this.animation.resume()}}}))}showErrorMessage(message){let errorDiv=document.getElementById("app-error");if(!errorDiv){errorDiv=document.createElement("div");errorDiv.id="app-error";errorDiv.style.cssText=`\n        position: fixed;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: #ff4444;\n        color: white;\n        padding: 15px 25px;\n        border-radius: 8px;\n        z-index: 10000;\n        max-width: 90%;\n        text-align: center;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n      `;document.body.appendChild(errorDiv)}errorDiv.textContent=message;setTimeout((()=>{if(errorDiv.parentNode){errorDiv.parentNode.removeChild(errorDiv)}}),5e3)}}const app=new InitApp;if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",(()=>app.initialize()))}else{app.initialize()}