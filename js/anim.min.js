import{CONFIG}from"./config.min.js";class MatrixAnim{constructor(options={}){this.canvas=document.getElementById("matrix-canvas");this.ctx=this.canvas.getContext("2d");this.symbols=["ğŸª","ğŸ¦´","ğŸ•","ğŸ±","ğŸ¾","â¤ï¸","ğŸ¥¨","ğŸ§€","ğŸ¥©","ğŸ¶","ğŸˆ","ğŸ–","ğŸ¦®","ğŸ•â€ğŸ¦º","ğŸ¾","ğŸª€"];this.config={dropFrequency:options.dropFrequency||CONFIG.ANIM.DROP_FREQUENCY,maxDrops:options.maxDrops||CONFIG.ANIM.MAX_DROPS,dropSpeed:options.dropSpeed||{min:CONFIG.ANIM.DROP_SPEED.MIN,max:CONFIG.ANIM.DROP_SPEED.MAX},dropSize:options.dropSize||{min:CONFIG.ANIM.DROP_SIZE.MIN,max:CONFIG.ANIM.DROP_SIZE.MAX}};this.animationId=null;this.resizeThrottle=null;this.poolSize=50;this.dropPool=[];this.activeDrops=[];this.init();this.setupEventListeners()}init(){this.initializePool();this.resizeCanvas();this.animate()}initializePool(){for(let i=0;i<this.poolSize;i++){this.dropPool.push({x:0,y:0,size:0,speed:0,symbol:"",rotation:0,rotationSpeed:0,active:false})}}resizeCanvas(){this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight}getRandomSymbol(){return this.symbols[Math.floor(Math.random()*this.symbols.length)]}createNewDrop(){if(this.drops.length>=this.config.maxDrops)return;const size=Math.random()*(this.config.dropSize.max-this.config.dropSize.min)+this.config.dropSize.min;this.drops.push({x:Math.random()*(this.canvas.width-size),y:-size,size:size,speed:Math.random()*(this.config.dropSpeed.max-this.config.dropSpeed.min)+this.config.dropSpeed.min,symbol:this.getRandomSymbol(),rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.1})}animate(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);if(Math.random()<this.config.dropFrequency&&this.activeDrops.length<this.config.maxDrops){this.createPooledDrop()}this.ctx.textAlign="center";this.ctx.textBaseline="middle";this.ctx.fillStyle="#00ff41";let lastFontSize=0;for(let i=this.activeDrops.length-1;i>=0;i--){const drop=this.activeDrops[i];drop.y+=drop.speed;drop.rotation+=drop.rotationSpeed;if(drop.y>this.canvas.height+drop.size){this.returnDropToPool(i);continue}const roundedSize=Math.round(drop.size);if(roundedSize!==lastFontSize){this.ctx.font=`${roundedSize}px Arial`;lastFontSize=roundedSize}this.ctx.save();this.ctx.translate(drop.x+drop.size/2,drop.y+drop.size/2);this.ctx.rotate(drop.rotation);this.ctx.fillText(drop.symbol,0,0);this.ctx.restore()}this.animationId=requestAnimationFrame((()=>this.animate()))}createPooledDrop(){const drop=this.dropPool.pop();if(!drop)return;const size=Math.random()*(this.config.dropSize.max-this.config.dropSize.min)+this.config.dropSize.min;drop.x=Math.random()*(this.canvas.width-size);drop.y=-size;drop.size=size;drop.speed=Math.random()*(this.config.dropSpeed.max-this.config.dropSpeed.min)+this.config.dropSpeed.min;drop.symbol=this.getRandomSymbol();drop.rotation=Math.random()*Math.PI*2;drop.rotationSpeed=(Math.random()-.5)*.1;drop.active=true;this.activeDrops.push(drop)}returnDropToPool(index){const drop=this.activeDrops.splice(index,1)[0];drop.active=false;this.dropPool.push(drop)}setupEventListeners(){window.addEventListener("resize",(()=>{if(this.resizeThrottle)return;this.resizeThrottle=setTimeout((()=>{this.resizeCanvas();this.resizeThrottle=null}),100)}));this.canvas.addEventListener("click",(()=>{if(this.animationId){cancelAnimationFrame(this.animationId);this.animationId=null}else{this.animate()}}));this.canvas.addEventListener("mousemove",(e=>{if(Math.random()<.3){this.createPooledDrop()}}))}pause(){if(this.animationId){cancelAnimationFrame(this.animationId);this.animationId=null}}resume(){if(!this.animationId){this.animate()}}destroy(){if(this.animationId){cancelAnimationFrame(this.animationId)}window.removeEventListener("resize",this.resizeCanvas)}}export{MatrixAnim};